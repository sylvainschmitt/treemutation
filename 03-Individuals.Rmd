```{r setupindividuals, include=FALSE}
rm(list = ls()) ; invisible(gc()) ; set.seed(42)
library(knitr)
library(kableExtra)
if(knitr:::is_html_output()) options(knitr.table.format = "html") 
if(knitr:::is_latex_output()) options(knitr.table.format = "latex") 
library(tidyverse)
library(raster)
library(leaflet)
library(sf)
theme_set(bayesplot::theme_default())
opts_chunk$set(
  echo = F, message = F, warning = F, fig.height = 6, fig.width = 8,
  cache = T, cache.lazy = F)
```

```{r dataindividuals, echo = F}
crs <- '+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0' # global crs definition
p <- read_csv(file = "data/Paracou TREEMUTATION candidates.csv")
coordinates(p) <- ~ lon + lat
proj4string(p) <- crs

path <- "~/Documents/BIOGECO/PhD/data/Paracou"
limits <- shapefile(file.path(path, "limits", "OverallPlots.shp"))
limits <- spTransform(limits, CRSobj = crs)

dcm2004 <- raster(file.path(path, "biotic", "Paracou2004_MNC1m.asc"))
dcm2009 <- raster(file.path(path, "biotic", "MNC_ParacouAvril2009_1m.tif"))
dcm2013 <- raster(file.path(path, "biotic", "ParacouMNS1m2013.asc"))
dcm2015 <- raster(file.path(path, "biotic", "ParacouMNS1m2015.asc"))
dem <- raster(file.path(path, "topography", "DEM_1m_2015.tif")) # for CRS
projection(dcm2004) <- projection(dem)
projection(dcm2009) <- projection(dem)
projection(dcm2013) <- projection(dem)
projection(dcm2015) <- projection(dem)
dcm2004 <- projectRaster(dcm2004, crs = crs)
dcm2009 <- projectRaster(dcm2009, crs = crs)
dcm2013 <- projectRaster(dcm2013, crs = crs)
dcm2015 <- projectRaster(dcm2015, crs = crs)
rm(dem)

# st_layers("data/Regina TREEMUTATION candidates.gpx")
r <- st_read("data/Regina TREEMUTATION candidates.gpx", layer = "waypoints")
```

# Individuals

## Paracou

```{r paracouIndividualsMap}
leaflet() %>%
  addTiles() %>% 
  addRasterImage(aggregate(dcm2004, 4), colors = "Greys", group = "DCM 2004") %>%
  addRasterImage(aggregate(dcm2009, 4), colors = "Greys", group = "DCM 2009") %>%
  addRasterImage(aggregate(dcm2013, 4), colors = "Greys", group = "DCM 2013") %>%
  addRasterImage(aggregate(dcm2015, 4), colors = "Greys", group = "DCM 2015") %>%
  addPolylines(data = limits, color = 'black', group = "Plots") %>%
  addCircles(data = p, group = "Individuals", col = "red", radius =  30) %>% 
  addLayersControl(overlayGroups = c("DCM 2004", "DCM 2009", "DCM 2013", "DCM 2015",
                                     'Plots', 'Individuals'),
                   options = layersControlOptions(collapsed = T))
```

## RÃ©gina

```{r reginaIndividualsMap}
leaflet() %>%
  addTiles() %>% 
  addCircles(data = r$geometry, group = "Individuals", col = "red", radius =  30)
```

## *Dycorinia guyanensis*

### Dgui3M P18-2-148

```{r, eval=F, echo=T}
library(lidR)
library(rgl)
las <- readLAS("data/YS-20201123-130625classclipDycorinia.las")
plot(las, bg = "white")
path <- "/home/sylvain/Documents/ECOFOG/treemutation/data/YS-20201123-130625classclipDycorinia.gif"
movie3d(spin3d(), duration = 5, movie = path)
```

```{r}
include_graphics("data/YS-20201123-130625classclipDycorinia.gif.gif")
```

